(()=>{"use strict";var e=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function c(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}d((i=i.apply(e,t||[])).next())}))};const t="cohere-token",n=()=>({Authorization:`bearer ${o()}`,"Content-Type":"application/json",Accept:"application/json"});function i(i){return e(this,void 0,void 0,(function*(){return i||(i=localStorage.getItem(t)),!(!i||(!i||!(yield(yield fetch("https://api.cohere.ai/v1/check-api-key",{headers:Object.assign(Object.assign({},n()),{Authorization:`bearer ${i}`}),method:"POST"})).json()).valid)&&(console.log("Invalid API key"),console.log("Please enter a valid API key"),1))}))}function o(){return localStorage.getItem(t)}function a(t){return e(this,arguments,void 0,(function*(e,{parts:t=0,history:i=[],final:o=[]}={},r){let c=Math.floor(1/3*100),d=`Summarize the ${t?1==t?`first ${c}% of the`:`next ${c}% of the`:""} story from this document, ${t>1?"START AFTER THE LAST SUMMARY DON'T REPEAT PREVIOUS SUMMARY":""} don't make anything up. Only use fact provided by the story. Use third person perspective, Make it into multiple paragraphs. Anything inside * or () is OOC, Out of character. Means, the character didnt actually say it.\nFor example *smile* means the character is smiling:`;console.log("Request to cohere ai");let l=[{title:"Story",text:e}];r&&r(t);let s=yield(yield fetch("https://api.cohere.ai/v1/chat",{body:JSON.stringify({preamble:"You are an ordinary man. you happened to like an interesting story\n\nYou got a job to summarize a story with the provided requirements without any questions",chat_history:i,documents:l,max_tokens:4090,temperature:.2,message:`${d}`}),method:"POST",headers:n()})).json();return console.log("Summary completed"),o.push({index:t,text:s.text}),null==t||0==t||t>=3?o:yield a(e,{parts:t+1,history:s.chat_history,final:o},r)}))}var r=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function c(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}d((i=i.apply(e,t||[])).next())}))};const c="webhook-url";function d(){return localStorage.getItem(c)}function l(e){return r(this,arguments,void 0,(function*(e,{multiples:t=!1,index:n=0,max:i=3}={}){let o=new FormData;const a=new Blob([e],{type:"text/plain"});let r=d();if(!r)throw new Error("Webhook url didn't exist");o.append("payload_json",JSON.stringify({embeds:[{title:"Chat Summary",color:10026942,author:{name:t?`Part (${n}/${i})`:""},description:e.slice(0,4090),footer:{text:"Cohere AI",icon_url:"https://raw.githubusercontent.com/mangadi3859/random/main/cai/images/cohere.png"},timestamp:(new Date).toISOString()}],username:"Summary"})),o.append("file[0]",a,`summary${t?`-part-${n}`:""}.txt`),yield fetch(r,{headers:{"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},referrer:"https://discohook.org/",referrerPolicy:"strict-origin",body:o,method:"POST",mode:"cors",credentials:"omit"}),console.log("Completed")}))}var s=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function c(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}d((i=i.apply(e,t||[])).next())}))};const u=()=>{return{headers:{Authorization:(null===(e=document.querySelector("[cai_token]"))||void 0===e?void 0:e.getAttribute("cai_token"))||""}};var e};function h(e){return s(this,arguments,void 0,(function*(e,t=!1,n=[],i){let o=yield function(e,t){return s(this,void 0,void 0,(function*(){return yield(yield fetch(`https://neo.character.ai/turns/${e}?next_token=${t}`,u())).json()}))}(e,i);var a;return n.push(...(a=o.turns,a.map((e=>`[${e.author.name}]\n<---- BEGIN ----\x3e\n${e.candidates[0].raw_content}\n<---- END ----\x3e`)))),t&&o.meta.next_token?h(e,t,n,o.meta.next_token):n}))}var v=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{d(i.next(e))}catch(e){a(e)}}function c(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}d((i=i.apply(e,t||[])).next())}))};document.querySelector(".cai_tools");const y=document.querySelector(".cait-body"),m=document.querySelector(".cai_tools-cont");!function(){v(this,void 0,void 0,(function*(){var n,p,f,b,g,S;const x=document.createElement("h6"),k=document.createElement("ul");x.innerText="Addon";const _=document.createElement("li"),w=document.createElement("li"),L=document.createElement("li"),I=document.createElement("div"),T=document.createElement("div"),E=document.createElement("div");function $(){I.classList.remove("active")}function A(){T.classList.remove("active")}function q(){E.classList.remove("active")}function M(){m.classList.remove("active")}_.innerText="Webhook",w.innerText="Cohere",L.innerText="Summarize",I.classList.add("cait_addons"),I.dataset.tool="cai_tools",I.innerHTML='\n<div class="cait_addons-cont">\n    <div class="cait_addons-header">\n        <h3>Webhook Settings</h3><span class="x-svg"></span>\n    </div>\n    <div class="cait_addons-body" style="display: flex;gap:.5rem;flex-direction:column;">\n    </div>\n    <div style="justify-content: center;" class="cait_addons-footer">\n        <button id="caitHookSave" style="background-color: var(--btn-primary);" class="btn">Save</button>\n    </div>\n</div>',_.addEventListener("click",(function(){return v(this,void 0,void 0,(function*(){M(),I.classList.add("active");let e=I.querySelector(".cait_addons-body");e&&(e.innerHTML=`\n        <label for="caitHookInput">Webhook URL</label>\n        <textarea id="caitHookInput" class="text-input" data-cait="hookInput" style="width:100%;resize:vertical;" row="5">${d()}</textarea>\n        <div style="${(yield function(e){return r(this,void 0,void 0,(function*(){return e||(e=localStorage.getItem(c)),!(!e||(!/^(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])$/gi.test(e)||"discord.com"!=new URL(e).hostname||!(yield fetch(e)).ok)&&(console.log("Webhook url is invalid"),1))}))}())?"display:none;":""} color: var(--btn-danger);">Invalid webhook, please enter a valid discord webhook url</div>\n        \n`)}))})),null===(n=I.querySelector(".x-svg"))||void 0===n||n.addEventListener("click",$),I.addEventListener("click",(e=>e.target==I&&$())),null===(p=I.querySelector("#caitHookSave"))||void 0===p||p.addEventListener("click",(e=>v(this,void 0,void 0,(function*(){!function(e){r(this,void 0,void 0,(function*(){return localStorage.setItem(c,e)}))}(I.querySelector("#caitHookInput").value),$()})))),k.append(_,w,L),null==y||y.append(x,k),document.body.append(I),T.classList.add("cait_addons"),T.dataset.tool="cai_tools",T.innerHTML='\n<div class="cait_addons-cont">\n    <div class="cait_addons-header">\n        <h3>Cohere Settings</h3><span class="x-svg"></span>\n    </div>\n    <div class="cait_addons-body" style="display: flex;gap:.5rem;flex-direction:column;">\n    </div>\n    <div style="justify-content: center;" class="cait_addons-footer">\n        <button id="caitCohereSave" style="background-color: var(--btn-primary);" class="btn">Save</button>\n    </div>\n</div>',w.addEventListener("click",(function(){return v(this,void 0,void 0,(function*(){M(),T.classList.add("active");let e=T.querySelector(".cait_addons-body");e&&(e.innerHTML=`\n        <label for="caitCohereInput">Cohere API Key</label>\n        <textarea id="caitCohereInput" class="text-input" data-cait="cohereInput" style="width:100%;resize:vertical;" row="5">${o()}</textarea>\n        <div style="${(yield i())?"display:none;":""} color: var(--btn-danger);">Invalid cohere ai TOKEN</div>\n`)}))})),null===(f=T.querySelector(".x-svg"))||void 0===f||f.addEventListener("click",A),T.addEventListener("click",(e=>e.target==T&&A())),null===(b=T.querySelector("#caitCohereSave"))||void 0===b||b.addEventListener("click",(n=>v(this,void 0,void 0,(function*(){let n=T.querySelector("#caitCohereInput");if(!(yield i(n.value)))return alert("Invalid cohere token. try again.");!function(n){e(this,void 0,void 0,(function*(){return localStorage.setItem(t,n)}))}(n.value),A()})))),document.body.append(T),E.classList.add("cait_addons"),E.dataset.tool="cai_tools",E.innerHTML='\n<div class="cait_addons-cont">\n    <div class="cait_addons-header">\n        <h3>Summary</h3><span class="x-svg"></span>\n    </div>\n    <div class="cait_addons-body" style="display: flex;gap:.5rem;flex-direction:column;">\n    </div>\n    <div style="justify-content: start; gap: 1rem;" class="cait_addons-footer">\n        <button id="caitSumSubmit" style="background-color: var(--btn-primary);" class="btn">Generate</button>\n        <button id="caitSendHook" style="display: none;background-color: var(--btn-primary);" class="btn">Send Webhook</button>\n    </div>\n</div>',L.addEventListener("click",(function(){return v(this,void 0,void 0,(function*(){M();let e=E.querySelector("#caitSumSubmit"),t=yield i();t||e.classList.add("disabled"),e.disabled=!t,E.classList.add("active");let n=E.querySelector(".cait_addons-body");n&&(n.innerHTML=`\n        <div style="display:flex;align-items:center;gap:.5rem;">\n            <label class="normal" for="caitFetchAllInput">Fetch all message</label>\n            <input type="checkbox" id="caitFetchAllInput" data-cait="summaryInput" />\n        </div>\n        <div style="display:flex;align-items:center;gap:.5rem;">\n            <label class="normal" for="caitMultipleInput">Multiple Summaries</label>\n            <input type="checkbox" id="caitMultipleInput" data-cait="summaryInput" />\n        </div>\n        <div style="${t?"display:none;":""} color: var(--btn-danger);">Invalid cohere ai TOKEN</div>        \n`)}))})),null===(g=E.querySelector(".x-svg"))||void 0===g||g.addEventListener("click",q),E.addEventListener("click",(e=>e.target==E&&q())),null===(S=E.querySelector("#caitSumSubmit"))||void 0===S||S.addEventListener("click",(e=>v(this,void 0,void 0,(function*(){let t=e.target,n=document.querySelector("#caitSendHook"),i=E.querySelector(".cait_addons-body");t.disabled=!0,t.innerText="Fetching chat data...";let o=function(){let e=window.location.pathname.match(/(?<=^\/chat\/).+$/);return e&&e[0]}(),r=yield function(e){return s(this,void 0,void 0,(function*(){return yield(yield fetch(`https://neo.character.ai/chats/recent/${e}`,u())).json()}))}(o);t.innerText="Fetching turns...";let c=i.querySelector("#caitFetchAllInput").checked,d=yield h(r.chats[0].chat_id,c);t.innerText="Generating Summaries...";let y=i.querySelector("#caitMultipleInput").checked,m=yield a(function(e){return e.reverse().map((e=>e.replace(/(\[-\])\(#-\s\"Memory:\s.+\"\)/g,""))).join("\n\n")}(d),{parts:y?1:0},(e=>{c&&(t.innerText=`Generating Summaries... (${e}/3)`)}));t.innerText="Done",i.innerHTML=i.innerHTML+`\n            <label>Result</label>\n            <p class="text-input" style="height:10rem;padding-block:.5rem;">${m.map((e=>e.text)).join("<br/><br/>")}</p>\n        `,n.style.display="block",n.addEventListener("click",(e=>v(this,void 0,void 0,(function*(){n.innerText="Sending webhook...",n.disabled=!0;for(let e of m)yield l(e.text,{index:e.index,max:3,multiples:y});n.style.display="none",t.innerText="Generate",n.innerText="Send Webhook",t.disabled=!1,n.disabled=!1,q()}))),{once:!0})})))),document.body.append(E)}))}()})();
//# sourceMappingURL=content.js.map